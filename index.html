<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Visor de Incendios Urbanos CDMX</title>
<!-- Leaflet CSS -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  integrity="sha256-sA+e2x0Dh6QhQQYB0cMClWcXdyc/NfNEl+o7PZY4nww="
  crossorigin=""
/>
<style>
  body, html { margin: 0; height: 100%; font-family: Arial, sans-serif; }
  #map { height: 100vh; width: 100%; }
  #radioBtn {
    position: absolute;
    top: 10px; left: 10px;
    background: white;
    padding: 8px 14px;
    cursor: pointer;
    border: 2px solid #666;
    border-radius: 5px;
    font-weight: bold;
    z-index: 1000;
    user-select: none;
  }
  #radioBtn.active {
    background: #f03;
    color: white;
    border-color: #d00;
  }
</style>
</head>
<body>

<div id="radioBtn" onclick="activarHerramientaRadio()">ðŸŽ¯ Activar Radio</div>
<div id="map"></div>

<!-- Leaflet JS -->
<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-o8WV7P5qqWmHoXBmfVAYW5tDkH+VwNGb6D3WrZlT8xo="
  crossorigin=""
></script>

<script>
  // Inicializar mapa centrado en CDMX
  const map = L.map('map').setView([19.4, -99.14], 11);

  // Capa base OSM
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: 'Â© OpenStreetMap'
  }).addTo(map);

  // Variable para la capa GeoJSON (pon aquÃ­ tu archivo)
  let geojsonLayer = null;

  // Carga GeoJSON (asegÃºrate que el archivo 'Incendios Urbanos 2022.geojson' estÃ© en la misma carpeta)
  fetch('Incendios Urbanos 2022.geojson')
    .then(res => res.json())
    .then(data => {
      geojsonLayer = L.geoJSON(data, {
        onEachFeature: (feature, layer) => {
          if (feature.properties && feature.properties.incidente_c4) {
            layer.bindPopup(
              `<b>Incidente:</b> ${feature.properties.incidente_c4}<br>` +
              `<b>AlcaldÃ­a:</b> ${feature.properties.alcaldia_cierre}<br>` +
              `<b>Colonia:</b> ${feature.properties.colonia_cierre}`
            );
          }
        },
        pointToLayer: (feature, latlng) => {
          return L.circleMarker(latlng, {
            radius: 6,
            fillColor: '#ff7800',
            color: '#000',
            weight: 1,
            opacity: 1,
            fillOpacity: 0.8
          });
        }
      }).addTo(map);
    })
    .catch(err => alert('Error cargando GeoJSON: ' + err));

  // Control del botÃ³n de radio
  let radioCapa = null;
  let modoRadio = false;

  function activarHerramientaRadio() {
    const radioBtn = document.getElementById('radioBtn');
    modoRadio = !modoRadio;
    radioBtn.classList.toggle('active');
    radioBtn.textContent = modoRadio ? 'ðŸ›‘ Cancelar Radio' : 'ðŸŽ¯ Activar Radio';
  }

  map.on('click', function(e) {
    if (!modoRadio) return;

    if (radioCapa) map.removeLayer(radioCapa);

    radioCapa = L.circle(e.latlng, {
      radius: 500,
      color: 'red',
      fillColor: '#f03',
      fillOpacity: 0.2
    }).addTo(map);

    // Contar incidentes dentro del radio
    let conteo = 0;
    if (geojsonLayer) {
      geojsonLayer.eachLayer(function(layer) {
        if (layer.getLatLng && e.latlng.distanceTo(layer.getLatLng()) <= 500) {
          conteo++;
        }
      });
    }

    radioCapa.bindPopup(`Incidentes en el radio: <strong>${conteo}</strong>`).openPopup();
  });
</script>

</body>
</html>

